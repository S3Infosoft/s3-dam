{% extends "base.html" %} {% load crispy_forms_tags %} {% block title %}{{ title
}} :: {% endblock title %} {% block content %}

<div class="container">
	<div class="row">
		<div class="card shadow text-center" style="margin: 5%;">
			<div class="card-header py-2 text-center">
				<span class="text-dark text-lg font-weight-bold"> Upload Document</span>
			</div>
			<form method="POST" id="data" class="form-horizontal">
				{% csrf_token %}
				<fieldset>
					<div class="form-group">
						<label class="col-sm-2 control-label">
							Description
						</label>
						<div class="col-sm-10">
							<textarea name="description" class="form-control"></textarea>
							<span class="help-block"
								>An optional short text describing a document.</span
							>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">
							Document type
						</label>
						<div class="col-sm-10">
							<select class="form-control" name="document_type">
								<option value="1">Default</option>
							</select>
							<span class="help-block">The document type of the document.</span>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">
							File
						</label>
						<div class="col-sm-10">
							<input name="file" type="file" id="file" />
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">
							Label
						</label>
						<div class="col-sm-10">
							<input name="label" class="form-control" type="text" />
							<span class="help-block">The name of the document.</span>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 control-label">
							Language
						</label>
						<div class="col-sm-10">
							<input name="language" class="form-control" type="text" />
							<span class="help-block"
								>The dominant language in the document.</span
							>
						</div>
					</div>
					<div class="form-actions">
						<button class="btn btn-primary">
							POST
						</button>
					</div>
				</fieldset>
			</form>
		</div>
	</div>
</div>
{% endblock content %} {% block extra_script %}
<script>
	// ////getting crsf token ///////////////////////////////////
	function getCookie(name) {
		var cookieValue = null;
		if (document.cookie && document.cookie !== "") {
			var cookies = document.cookie.split(";");
			for (var i = 0; i < cookies.length; i++) {
				var cookie = cookies[i].trim();
				// Does this cookie string begin with the name we want?
				if (cookie.substring(0, name.length + 1) === name + "=") {
					cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
					break;
				}
			}
		}
		return cookieValue;
	}

	function csrfSafeMethod(method) {
		// these HTTP methods do not require CSRF protection
		return /^(GET|HEAD|OPTIONS|TRACE)$/.test(method);
	}

	var csrftoken = getCookie("csrftoken");

	$.ajaxSetup({
		beforeSend: function (xhr, settings) {
			if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
				xhr.setRequestHeader("X-CSRFToken", csrftoken);
			}
		},
	});

	////////////////////////////////////////////////////////

	$("form#data").submit(function (e) {
		console.log(e);
		e.preventDefault();
		var formData = new FormData();
		formData.append("file", $("#file")[0].files[0]);
		formData.append("document_type", "1");
		console.log(formData);

		$.ajax({
			url: "http://localhost/api/documents/",
			header: {
				Authorization: "Bearer 3aa3a1f4653d973382742111cf42df8193413f9f",
			},
			type: "POST",
			dataType: "json",
			data: formData,
			cache: false,
			contentType: false,
			processData: false,
			success: function (data) {
				alert(data);
			},
		});
	});
</script>
{% endblock extra_script %}
